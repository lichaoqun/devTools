#!/bin/bash
DIR="$(pwd)"
NOW=`date +%m-%d_%H:%M`
Desktop="$(cd ~/Desktop && pwd)"

echo $DIR;
echo $NOW;
echo $Desktop;

function run {
	echo "Executing command: $@"
	$@
	if [[ $? != "0" ]]; then
		echo "Executing the above command has failed!"
		exit 1
	fi
}

function run_at {
	pushd $1
	shift
	run $@
	popd
}

echo "================== (create ipa file...) =================="

# åˆ é™¤å·²ç»å­˜åœ¨çš„ Payload æ–‡ä»¶å¤¹
run "rm -rf ${DIR}/Target.ipa ${DIR}/Payload"

# åˆ›å»º Payload æ–‡ä»¶å¤¹
run "mkdir ${DIR}/Payload"

# è·å–æ–‡ä»¶è·¯å¾„
APP=$(find ${DIR} -type d | grep ".app$" | head -n 1)

# æŠŠ APP æ‹·è´åˆ° Payload æ–‡ä»¶å¤¹ä¸‹
run "cp -rf ${APP} ${DIR}/Payload"

# æŠŠ Payload å‹ç¼© å¹¶å‘½åä¸º Target.ipa 
run_at ${DIR} "zip -qr Target.ipa Payload"

# åˆ é™¤ Payload æ–‡ä»¶å¤¹
run "rm -rf ${DIR}/Payload"

# å¦‚æœæ¡Œé¢ä¸å­˜åœ¨ ipa çš„æ–‡ä»¶å¤¹ åˆ™åˆ›å»ºä¸€ä¸ª
mkdir -p "$Desktop/ipa"

# ç§»åŠ¨åˆ°æ¡Œé¢çš„ ipa æ–‡ä»¶å¤¹ä¸­
mv -f "${DIR}/Target.ipa"  "$Desktop/ipa/Target_$NOW.ipa"

echo "================== ( ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ğŸ‰ ) =================="

exit;